<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registro de Horas ‚Äî Sushi Time</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
  <style>
    :root { --primary:#6366f1; --secondary:#6b7280; --danger:#ef4444; --bg:#fafafa; --card:#ffffff; --radius:12px; --muted:#6b7280 }
    body{font-family:Inter, Arial, sans-serif;background:var(--bg);margin:0;padding:24px;color:#111827;}
    body.dark{background:#111827;color:#f3f4f6}
    .container{max-width:1050px;margin:0 auto;background:var(--card);border-radius:var(--radius);box-shadow:0 8px 25px rgba(0,0,0,0.05);padding:24px;}
    .brand{text-align:center;font-size:18px;font-weight:bold;color:var(--primary);margin-bottom:10px;}
    .topbar{display:flex;justify-content:flex-start;align-items:center;gap:10px;margin-bottom:15px;flex-wrap:wrap}
    .topbar .spacer{flex:1}
    .card{border:1px solid #e5e7eb;border-radius:var(--radius);padding:16px;background:#fff;margin-top:14px;}
    body.dark .card{background:#1f2937;border-color:#374151;color:#f9fafb}
    label{display:block;font-size:14px;color:var(--muted);margin-top:10px}
    input,select{width:100%;padding:10px;border-radius:8px;border:1px solid #e5e7eb;margin-top:4px;font-size:14px;box-sizing:border-box}
    .form-row{display:flex;gap:12px;flex-wrap:wrap;margin-top:6px}
    .form-row > div{flex:1;min-width:0}
    .btn-group{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    button{padding:8px 12px;border-radius:8px;border:0;color:#fff;cursor:pointer;transition:background 0.3s}
    button.primary{background:var(--primary)}button.secondary{background:var(--secondary)}button.ghost{background:transparent;color:var(--primary);border:1px solid #d1d5db}
    table{width:100%;border-collapse:collapse;margin-top:14px}
    th,td{border-bottom:1px solid #e5e7eb;padding:10px;font-size:14px}
    th{background:#f9fafb;color:var(--muted);text-align:left}
    .badge{background:rgba(99,102,241,0.1);color:var(--primary);font-size:12px;padding:4px 8px;border-radius:999px}
    .action-btn{padding:6px 10px;border-radius:6px;border:none;cursor:pointer}
    .edit-btn{background:#c7d2fe;color:#1e3a8a}.del-btn{background:#fee2e2;color:#b91c1c}
  </style>
</head>
<body>
  <div class="container">
    <div class="brand">Development by Christian Sena</div>
    <div class="topbar">
      <button class="ghost" id="darkModeBtn" type="button">üåô</button>
      <button id="btnExportExcel" class="primary">Exportar a Excel</button>
      <button id="btnImportExcel" class="secondary">Importar desde Excel</button>
      <input type="file" id="fileExcel" accept=".csv" style="display:none" />
      <div class="spacer"></div>
    </div>

    <div class="card">
      <label for="empleado">Empleado</label>
      <input type="text" id="empleado" placeholder="Nombre del empleado">

      <div class="form-row">
        <div>
          <label for="dia">D√≠a</label>
          <select id="dia">
            <option value="lunes">Lunes</option>
            <option value="martes">Martes</option>
            <option value="miercoles">Mi√©rcoles</option>
            <option value="jueves">Jueves</option>
            <option value="viernes">Viernes</option>
            <option value="sabado">S√°bado</option>
            <option value="domingo">Domingo</option>
          </select>
        </div>
        <div>
          <label for="entrada">Entrada</label>
          <input type="time" id="entrada" value="20:00">
        </div>
        <div>
          <label for="salida">Salida</label>
          <input type="time" id="salida">
        </div>
      </div>

      <div class="btn-group">
        <button id="btnAgregar" class="primary">Agregar</button>
        <button id="btnEditar" class="secondary" disabled>Guardar cambios</button>
        <button id="btnVaciarTodo" class="ghost">Vaciar todo</button>
        <span style="margin-left:auto" class="badge" id="countBadge">0 registros</span>
      </div>
    </div>

    <h3 style="margin-top:18px">Registros en tiempo real</h3>
    <div class="card">
      <table>
        <thead>
          <tr><th>Empleado</th><th>D√≠a</th><th>Entrada</th><th>Salida</th><th>Horas</th><th>Acciones</th></tr>
        </thead>
        <tbody id="tabla-registro"></tbody>
        <tfoot><tr><td><strong>Total</strong></td><td colspan="3"></td><td id="totalHoras">0h 0m 0s</td><td></td></tr></tfoot>
      </table>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDSxZILNH92QqkfnQeSpYZeboqylAo_6S0",
      authDomain: "sushitime-b84fc.firebaseapp.com",
      databaseURL: "https://sushitime-b84fc-default-rtdb.firebaseio.com",
      projectId: "sushitime-b84fc",
      storageBucket: "sushitime-b84fc.appspot.com",
      messagingSenderId: "821112951317",
      appId: "1:821112951317:web:489461e64376ed9daab41c",
      measurementId: "G-JLLVJ1ZR67"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const empleado = document.getElementById('empleado');
    const dia = document.getElementById('dia');
    const entrada = document.getElementById('entrada');
    const salida = document.getElementById('salida');
    const btnAgregar = document.getElementById('btnAgregar');
    const btnEditar = document.getElementById('btnEditar');
    const btnVaciarTodo = document.getElementById('btnVaciarTodo');
    const tabla = document.getElementById('tabla-registro');
    const countBadge = document.getElementById('countBadge');
    const totalHorasEl = document.getElementById('totalHoras');

    let editId = null;

    function calcularHoras(e, s){
      if(!e || !s) return 0;
      const t1 = new Date('1970-01-01T'+e+':00');
      const t2 = new Date('1970-01-01T'+s+':00');
      let diff = (t2 - t1)/1000;
      if(diff < 0) diff += 86400;
      return diff;
    }

    function formatHMS(seconds){
      const h = Math.floor(seconds / 3600);
      const m = Math.floor((seconds % 3600) / 60);
      const s = seconds % 60;
      return `${h}h ${m}m ${s}s`;
    }

    btnAgregar.addEventListener('click', () => {
      const id = Date.now();
      const diff = calcularHoras(entrada.value, salida.value);
      const registro = {
        empleado: empleado.value.trim(),
        dia: dia.value,
        entrada: entrada.value,
        salida: salida.value,
        segundos: diff
      };
      if(!registro.empleado){ alert('Ingrese un nombre de empleado'); return; }
      db.ref('registros/' + id).set(registro);
      limpiarFormulario();
    });

    btnEditar.addEventListener('click', () => {
      if(!editId) return;
      const diff = calcularHoras(entrada.value, salida.value);
      const registro = {
        empleado: empleado.value.trim(),
        dia: dia.value,
        entrada: entrada.value,
        salida: salida.value,
        segundos: diff
      };
      db.ref('registros/' + editId).update(registro);
      limpiarFormulario();
    });

    db.ref('registros').on('value', snapshot => {
      tabla.innerHTML = '';
      let count = 0;
      let total = 0;
      snapshot.forEach(child => {
        const data = child.val();
        const id = child.key;
        total += parseInt(data.segundos)||0;
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${data.empleado}</td><td>${data.dia}</td><td>${data.entrada}</td><td>${data.salida}</td><td>${formatHMS(data.segundos)}</td>
        <td>
          <button class='action-btn edit-btn' onclick='editarRegistro("${id}")'>Editar</button>
          <button class='action-btn del-btn' onclick='eliminarRegistro("${id}")'>Eliminar</button>
        </td>`;
        tabla.appendChild(tr);
        count++;
      });
      countBadge.textContent = `${count} registros`;
      totalHorasEl.textContent = formatHMS(total);
    });

    function eliminarRegistro(id){
      if(confirm('¬øSeguro que deseas eliminar este registro?')){
        db.ref('registros/'+id).remove();
      }
    }

    function editarRegistro(id){
      db.ref('registros/'+id).once('value').then(snap => {
        const data = snap.val();
        empleado.value = data.empleado;
        dia.value = data.dia;
        entrada.value = data.entrada;
        salida.value = data.salida;
        editId = id;
        btnAgregar.disabled = true;
        btnEditar.disabled = false;
      });
    }

    btnVaciarTodo.addEventListener('click', ()=>{
      if(confirm('¬øBorrar todos los registros?')){
        db.ref('registros').remove();
      }
    });

    function limpiarFormulario(){
      empleado.value = '';
      entrada.value = '20:00';
      salida.value = '';
      editId = null;
      btnAgregar.disabled = false;
      btnEditar.disabled = true;
    }

    const darkBtn = document.getElementById('darkModeBtn');
    darkBtn.addEventListener('click', ()=>{
      const isDark = document.body.classList.toggle('dark');
      darkBtn.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
    });

    window.eliminarRegistro = eliminarRegistro;
    window.editarRegistro = editarRegistro;
  </script>
</body>
</html>
